'use strict';var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a},_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_react=require('react'),_react2=_interopRequireDefault(_react),_propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var scriptLoading=!1,scriptLoaded=!1,scriptDidError=!1,ReactStripeCheckout=function(a){function b(h){_classCallCheck(this,b);var j=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,h));return j.onScriptLoaded=function(){b.stripeHandler||(b.stripeHandler=StripeCheckout.configure({key:j.props.stripeKey}),j.hasPendingClick&&j.showStripeDialog())},j.onScriptError=function(){for(var l=arguments.length,k=Array(l),m=0;m<l;m++)k[m]=arguments[m];j.hideLoadingDialog(),j.props.onScriptError&&j.props.onScriptError.apply(j,k)},j.onClosed=function(){for(var l=arguments.length,k=Array(l),m=0;m<l;m++)k[m]=arguments[m];j._isMounted&&j.setState({open:!1}),j.props.closed&&j.props.closed.apply(j,k)},j.onOpened=function(){for(var l=arguments.length,k=Array(l),m=0;m<l;m++)k[m]=arguments[m];j.setState({open:!0}),j.props.opened&&j.props.opened.apply(j,k)},j.getConfig=function(){return['token','image','name','description','amount','locale','currency','panelLabel','zipCode','shippingAddress','billingAddress','email','allowRememberMe','bitcoin','alipay','alipayReusable'].reduce(function(k,l){return Object.assign({},k,j.props.hasOwnProperty(l)&&_defineProperty({},l,j.props[l]))},{opened:j.onOpened,closed:j.onClosed})},j.onClick=function(){if(!j.props.disabled)if(scriptDidError)try{throw new Error('Tried to call onClick, but StripeCheckout failed to load')}catch(k){}else b.stripeHandler?j.showStripeDialog():(j.showLoadingDialog(),j.hasPendingClick=!0)},j.handleOnMouseDown=function(){j.setState({buttonActive:!0})},j.handleOnMouseUp=function(){j.setState({buttonActive:!1})},j.state={open:!1,buttonActive:!1},j}return _inherits(b,a),_createClass(b,[{key:'componentDidMount',value:function componentDidMount(){var j=this;if(this._isMounted=!0,scriptLoaded=!0,scriptLoaded)return this.updateStripeHandler();if(!scriptLoading){scriptLoading=!0;var h=document.createElement('script');'function'==typeof this.props.onScriptTagCreated&&this.props.onScriptTagCreated(h),h.src='https://checkout.stripe.com/checkout.js',h.async=1,this.loadPromise=function(){var k=!1,l=new Promise(function(n,o){h.onload=function(){scriptLoaded=!0,scriptLoading=!1,n(),j.onScriptLoaded()},h.onerror=function(p){scriptDidError=!0,scriptLoading=!1,o(p),j.onScriptError(p)}}),m=new Promise(function(n,o){l.then(function(){return k?o({isCanceled:!0}):n()}),l.catch(function(p){return k?o({isCanceled:!0}):o(p)})});return{promise:m,cancel:function cancel(){k=!0}}}(),this.loadPromise.promise.then(this.onScriptLoaded).catch(this.onScriptError),document.body.appendChild(h)}}},{key:'componentDidUpdate',value:function componentDidUpdate(){scriptLoading||this.updateStripeHandler()}},{key:'componentWillUnmount',value:function componentWillUnmount(){this._isMounted=!1,this.loadPromise&&this.loadPromise.cancel(),b.stripeHandler&&this.state.open&&b.stripeHandler.close()}},{key:'updateStripeHandler',value:function updateStripeHandler(){(!b.stripeHandler||this.props.reconfigureOnUpdate)&&(b.stripeHandler=StripeCheckout.configure({key:this.props.stripeKey}))}},{key:'showLoadingDialog',value:function showLoadingDialog(){if(this.props.showLoadingDialog){for(var j=arguments.length,h=Array(j),k=0;k<j;k++)h[k]=arguments[k];this.props.showLoadingDialog.apply(this,h)}}},{key:'hideLoadingDialog',value:function hideLoadingDialog(){if(this.props.hideLoadingDialog){for(var j=arguments.length,h=Array(j),k=0;k<j;k++)h[k]=arguments[k];this.props.hideLoadingDialog.apply(this,h)}}},{key:'showStripeDialog',value:function showStripeDialog(){this.hideLoadingDialog(),b.stripeHandler.open(this.getConfig())}},{key:'renderDefaultStripeButton',value:function renderDefaultStripeButton(){return _react2.default.createElement('button',_extends({},_defineProperty({},this.props.triggerEvent,this.onClick),{className:this.props.className,onMouseDown:this.handleOnMouseDown,onFocus:this.handleOnMouseDown,onMouseUp:this.handleOnMouseUp,onMouseOut:this.handleOnMouseUp,onBlur:this.handleOnMouseUp,style:Object.assign({},{overflow:'hidden',display:'inline-block',background:'linear-gradient(#28a0e5,#015e94)',border:0,padding:1,textDecoration:'none',borderRadius:5,boxShadow:'0 1px 0 rgba(0,0,0,0.2)',cursor:'pointer',visibility:'visible',userSelect:'none'},this.state.buttonActive&&{background:'#005d93'},this.props.style)}),_react2.default.createElement('span',{style:Object.assign({},{backgroundImage:'linear-gradient(#7dc5ee,#008cdd 85%,#30a2e4)',fontFamily:'"Helvetica Neue",Helvetica,Arial,sans-serif',fontSize:14,position:'relative',padding:'0 12px',display:'block',height:30,lineHeight:'30px',color:'#fff',fontWeight:'bold',boxShadow:'inset 0 1px 0 rgba(255,255,255,0.25)',textShadow:'0 -1px 0 rgba(0,0,0,0.25)',borderRadius:4},this.state.buttonActive&&{color:'#eee',boxShadow:'inset 0 1px 0 rgba(0,0,0,0.1)',backgroundImage:'linear-gradient(#008cdd,#008cdd 85%,#239adf)'},this.props.textStyle)},this.props.label))}},{key:'renderDisabledButton',value:function renderDisabledButton(){return _react2.default.createElement('button',{disabled:!0,style:{background:'rgba(0,0,0,0.2)',overflow:'hidden',display:'inline-block',border:0,padding:1,textDecoration:'none',borderRadius:5,userSelect:'none'}},_react2.default.createElement('span',{style:{boxShadow:'inset 0 1px 0 rgba(255,255,255,0.25)',fontFamily:'"Helvetica Neue",Helvetica,Arial,sans-serif',fontSize:14,position:'relative',padding:'0 12px',display:'block',height:30,lineHeight:'30px',borderRadius:4,color:'#999',background:'#f8f9fa',textShadow:'0 1px 0 rgba(255,255,255,0.5)'}},this.props.label))}},{key:'render',value:function render(){!0!==this.props.desktopShowModal||this.state.open?!1===this.props.desktopShowModal&&this.state.open&&b.stripeHandler.close():this.onClick();var h=this.props.ComponentClass;return this.props.children?_react2.default.createElement(h,_extends({},_defineProperty({},this.props.triggerEvent,this.onClick),{children:this.props.children})):this.props.disabled?this.renderDisabledButton():this.renderDefaultStripeButton()}}]),b}(_react2.default.Component);ReactStripeCheckout.defaultProps={className:'StripeCheckout',label:'Pay With Card',locale:'auto',ComponentClass:'span',reconfigureOnUpdate:!1,triggerEvent:'onClick'},ReactStripeCheckout.propTypes={desktopShowModal:_propTypes2.default.bool,triggerEvent:_propTypes2.default.oneOf(['onClick','onTouchTap','onTouchStart']),label:_propTypes2.default.string,style:_propTypes2.default.object,textStyle:_propTypes2.default.object,disabled:_propTypes2.default.bool,ComponentClass:_propTypes2.default.string,showLoadingDialog:_propTypes2.default.func,hideLoadingDialog:_propTypes2.default.func,onScriptError:_propTypes2.default.func,onScriptTagCreated:_propTypes2.default.func,reconfigureOnUpdate:_propTypes2.default.bool,stripeKey:_propTypes2.default.string.isRequired,token:_propTypes2.default.func.isRequired,name:_propTypes2.default.string,description:_propTypes2.default.string,image:_propTypes2.default.string,amount:_propTypes2.default.number,locale:_propTypes2.default.oneOf(['auto','zh','da','nl','en','fr','de','it','ja','no','es','sv']),currency:_propTypes2.default.oneOf(['AED','AFN','ALL','AMD','ANG','AOA','ARS','AUD','AWG','AZN','BAM','BBD','BDT','BGN','BIF','BMD','BND','BOB','BRL','BSD','BWP','BZD','CAD','CDF','CHF','CLP','CNY','COP','CRC','CVE','CZK','DJF','DKK','DOP','DZD','EEK','EGP','ETB','EUR','FJD','FKP','GBP','GEL','GIP','GMD','GNF','GTQ','GYD','HKD','HNL','HRK','HTG','HUF','IDR','ILS','INR','ISK','JMD','JPY','KES','KGS','KHR','KMF','KRW','KYD','KZT','LAK','LBP','LKR','LRD','LSL','LTL','LVL','MAD','MDL','MGA','MKD','MNT','MOP','MRO','MUR','MVR','MWK','MXN','MYR','MZN','NAD','NGN','NIO','NOK','NPR','NZD','PAB','PEN','PGK','PHP','PKR','PLN','PYG','QAR','RON','RSD','RUB','RWF','SAR','SBD','SCR','SEK','SGD','SHP','SLL','SOS','SRD','STD','SVC','SZL','THB','TJS','TOP','TRY','TTD','TWD','TZS','UAH','UGX','USD','UYU','UZS','VND','VUV','WST','XAF','XCD','XOF','XPF','YER','ZAR','ZMW']),panelLabel:_propTypes2.default.string,zipCode:_propTypes2.default.bool,billingAddress:_propTypes2.default.bool,shippingAddress:_propTypes2.default.bool,email:_propTypes2.default.string,allowRememberMe:_propTypes2.default.bool,bitcoin:_propTypes2.default.bool,alipay:_propTypes2.default.oneOf(['auto',!0,!1]),alipayReusable:_propTypes2.default.bool,opened:_propTypes2.default.func,closed:_propTypes2.default.func},ReactStripeCheckout._isMounted=!1,exports.default=ReactStripeCheckout;